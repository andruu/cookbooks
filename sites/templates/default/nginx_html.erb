# Autogenerated by Chef for <%= @node[:fqdn] %>

server {
  listen       80;
  server_name  <%= @subdomain %><%= @hostname %> www.<%= @subdomain %><%= @hostname %>;
  root         <%= @root %>;
  index        index.html index.htm;
  error_page   500 501 502 503 504  /error_500.html;
  charset      utf-8;

  server_tokens off;
  server_name_in_redirect off;

  access_log   <%= @node[:nginx][:log_dir] %>/<%= @subdomain %><%= @hostname %>-access.log;
  error_log    <%= @node[:nginx][:log_dir] %>/<%= @subdomain %><%= @hostname %>-error.log;

  # remove www from the url
  if ($host ~* www\.(.*)) {
    set $host_without_www $1;
    rewrite ^(.*)$ http://$host_without_www$1 permanent;
  }

  location ~ /\.ht {
    deny  all;
  }

}